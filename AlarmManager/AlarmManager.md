Android-AlarmManager

1. AlarmManager启动的是system service，是独立于APP以外的服务，由Android系统来调度系统资源，所以即使APP进程未启动，也依然可以在定时时间到达后执行某些动作，触发某些事件，启动该APP等。如果使用得当的话，是可以减少系统资源的消耗。在设置定时方面，AlarmManager的性能要优于 Handler, Timer 等方式，具体对比如下表所示：

   |            | AlarmManager                             | Handler                                  | Timer                                    |
   | ---------- | :--------------------------------------- | ---------------------------------------- | ---------------------------------------- |
   | 实现定时功能的API | set(),          setExact(), setRepeating(), setInexactRepeating() | postDelayed(), sendMessageDelayed()      | schedule(TimerTask task, Date time)      |
   | 优缺点        | 无需轮询等待，由系统统一规划闹钟的执行                      | 如果一个消息被设置延迟到未来某个时间点才去执行，那么在调用 MessageQueue.next()即将让该消息出列时，由于执行时间未到，那么队列就会一直轮询等待该时间的到达，这样会导致在等待期间依然会耗费系统资源，造成浪费。 | Timer的构造方法里会启动一个线程，线程会一直执行mainLoop()方法。如果一个任务被设置延迟到未来某个时间点才去执行，那么该线程将会一直轮询等待执行时间的到达，这样会导致在等待期间依然会耗费系统资源，造成浪费 |
   | 对系统资源的耗费   | 如果合理使用，将有助于降低系统资源的整体消耗                   | 可能会浪费系统资源                                | 可能会浪费系统资源                                |
   | 建议         | 建议使用                                     | 建议不使用，除非有特殊场景需求                          | 建议不使用，除非有特殊场景需求                          |

2. AlarmManager分为两种时钟类型：ERT (elapsed real time), RTC (real time clock)。 这两种时钟类型又都有wakeup和非wakeup两种子类别。wakeup表示系统处于sleep状态时依然会唤醒系统。下表是对这两种类型闹钟的介绍和对比：

   |          | ERT                                      | RTC                                      |
   | -------- | ---------------------------------------- | ---------------------------------------- |
   | 全称       | elapsed real time                        | real time clock                          |
   | 概念       | 手机开机时长(系统休眠的时长也计算在内)，是个时间段的长度。单位 ms      | wall clock时间点，是个时间点，不是时间段                |
   | 外部依赖     | 无                                        | 依赖于手机设置的时区和时间（timezone, date & time）     |
   | 适用场景     | 与time zone/locale及date&time无关的场景，一般是手机开机后多久时间后要执行某个动作的场景。 | 与time zone/locale及date&time相关的场景，一般是在某个日期的某个时间点要执行某个动作的场景。 |
   | 受外部依赖的影响 | 无                                        | 1. 如果手机的日期时间被修改，将会影响先前已设定的闹钟。例如：用户修改了时间，或者clock time随着GPS或network的切换而切换。                                                          2. 如果手机所处的locale切换了，而app没有成功切换locale，那么触发闹钟的时间将仍然使用的是旧locale的时间 |
   | 建议       | 如无特殊需求，建议使用该类型的闹钟                        |                                          |

3. 最佳实践

   (1) 关于访问服务器的情况，为了防止同一服务器在短时间内接收到来自多个客户端的同时访问而导致服务器负荷大，建议对闹钟的时间添加一些随机因子。

   (2) 保证闹钟响起的频率尽可能低。

   (3) 如果对闹钟闹铃的时间点没有严格的要求，尽量使用非wakeup类型的闹钟，这样可以避免系统在sleep状态下被唤醒, 起到省电的作用，但是闹铃会被推迟到系统退出休眠模式后触发。

   (4) 如果对闹钟闹铃的时间点没有严格的要求，尽量使用非精确时间的模式来设置闹钟的闹铃时间，即：尽量少用setExact()这样的API， 这样可以减少系统处理闹铃的频率，系统会在同一时间批量处理来自多个APP的闹铃需求，起到省电的作用，但是闹铃的时间可能会被推迟。

   (5) 如果闹铃对于 time zone/locale及date&time 没有要求，尽量使用 ERT (elapsed real time) 类型的闹钟。

4. 手机重启对闹钟的影响

   默认情况下，手机重启后会取消掉所有已设定的闹钟。所以如果想要让手机在重启后默认再次启动先前设定的闹钟，可以按照如下步骤操作：































​

​